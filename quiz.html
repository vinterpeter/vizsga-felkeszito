<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kvíz - Spaced Repetition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .deck-info {
            color: #888;
            font-size: 0.9rem;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        .stat-item.correct .stat-value { color: #00ff88; }
        .stat-item.incorrect .stat-value { color: #ff6b6b; }
        .stat-item.streak .stat-value { color: #feca57; }
        .stat-item.mastered .stat-value { color: #9b59b6; }

        /* Progress Bar */
        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Question Card */
        .question-card {
            background: linear-gradient(145deg, #2a2a4a, #1e1e3a);
            border: 2px solid rgba(255, 107, 107, 0.3);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .question-number {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.5rem;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .question-tags {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .question-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 12px;
            margin: 15px 0;
            object-fit: contain;
        }

        .answer-image {
            max-width: 80px;
            max-height: 60px;
            border-radius: 8px;
            margin-left: 10px;
            object-fit: contain;
            vertical-align: middle;
        }

        .tag {
            background: rgba(255,255,255,0.1);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            color: #888;
        }

        /* Answer Options */
        .answers-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .answer-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .answer-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .answer-btn:disabled {
            cursor: default;
        }

        .answer-btn.correct {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .answer-btn.incorrect {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
        }

        .answer-btn.show-correct {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.5);
        }

        .answer-key {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            text-align: center;
            line-height: 28px;
            margin-right: 12px;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .answer-btn.correct .answer-key {
            background: #00ff88;
            color: #1a1a2e;
        }

        .answer-btn.incorrect .answer-key {
            background: #ff6b6b;
            color: #1a1a2e;
        }

        /* Feedback */
        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .feedback.visible {
            display: block;
        }

        .feedback.correct {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .feedback.incorrect {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .feedback-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .feedback-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .feedback-explanation {
            color: #aaa;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Next Button */
        .next-btn {
            display: none;
            width: 100%;
            padding: 18px;
            background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn.visible {
            display: block;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        /* Streak Indicator */
        .streak-indicator {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .streak-fire {
            color: #feca57;
        }

        /* Session Complete */
        .session-complete {
            text-align: center;
            padding: 40px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
        }

        .session-complete h2 {
            color: #00ff88;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(#00ff88 var(--score), rgba(255,255,255,0.1) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 120px;
            height: 120px;
            background: #1e1e3a;
            border-radius: 50%;
            position: absolute;
        }

        .score-value {
            position: relative;
            z-index: 1;
            font-size: 2.5rem;
            font-weight: bold;
            color: #00ff88;
        }

        .session-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .session-stat {
            text-align: center;
        }

        .session-stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .session-stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            padding: 12px 30px;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
        }

        /* Shortcuts */
        .shortcuts {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
        }

        .shortcuts h4 {
            color: #888;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .shortcut-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .shortcut {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
        }

        .key {
            background: rgba(255,255,255,0.1);
            padding: 4px 10px;
            border-radius: 5px;
            font-family: monospace;
            color: #feca57;
        }

        /* Load Custom */
        .load-custom {
            text-align: center;
            margin: 20px 0;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .answers-container {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                flex-wrap: wrap;
                gap: 15px;
            }

            .stat-item {
                flex: 1 1 40%;
            }

            .question-text {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Kvíz</h1>
            <p class="deck-info" id="deckInfo">Spaced Repetition Quiz System</p>
        </header>

        <div id="app">
            <div class="loading">
                <div class="spinner"></div>
                <p>Kérdések betöltése...</p>
            </div>
        </div>

        <div class="load-custom">
            <input type="file" id="fileInput" accept=".json" style="display:none">
            <button class="control-btn" onclick="document.getElementById('fileInput').click()">
                Saját JSON betöltése
            </button>
        </div>

        <div class="shortcuts">
            <h4>Billentyűparancsok</h4>
            <div class="shortcut-list">
                <div class="shortcut"><span class="key">1-4</span> Válasz kiválasztása</div>
                <div class="shortcut"><span class="key">Enter</span> Következő kérdés</div>
                <div class="shortcut"><span class="key">R</span> Visszaállítás</div>
            </div>
        </div>
    </div>

    <script>
        // Default embedded quiz questions - Harci kiszolgáló támogatás vizsgafelkészítő
        const DEFAULT_DATA = {
            "quiz": {
                "name": "Harci kiszolgáló támogatás - Vizsgafelkészítő Kvíz",
                "description": "A Magyar Honvédség harci kiszolgáló támogatás tananyagából összeállított vizsgakérdések: logisztika alapelvei, készletlépcsőzés, hadtáp és haditechnikai támogatás, egészségügyi biztosítás, Role szintek, TCCC, MEDEVAC"
            },
            "questions": [
                {"id": 1, "question": "Mik a logisztikai támogatás alapelvei?", "answers": ["Csak gazdaságosság és hatékonyság", "Műveletek elsődlegessége, egyszerűség, rugalmasság, gazdaságosság, együttműködés, láthatóság", "Gyorsaság és pontosság", "Csak az utánpótlás biztosítása"], "correct": 1, "explanation": "A logisztikai támogatás alapelvei: a műveletek elsődlegessége, egyszerűség, rugalmasság, gazdaságosság, együttműködés, láthatóság.", "tags": ["logisztika", "alapelvek"]},
                {"id": 2, "question": "Mi a DOS (Day of Supply) jelentése?", "answers": ["Napi ellátmány - egy adott hadianyagból egy napra szükséges mennyiség", "Digitális műveleti rendszer", "Támadási nap megnevezése", "Dandár szervezési séma"], "correct": 0, "explanation": "DOS = Day of Supply (napi ellátmány) - adott hadianyagból egy napra szükséges mennyiség norma szerinti felhasználással.", "tags": ["logisztika", "DOS"]},
                {"id": 3, "question": "Hány DOS lőszerkészletet tart a zászlóalj?", "answers": ["2 DOS", "3 DOS", "5 DOS", "10 DOS"], "correct": 2, "explanation": "A zászlóalj 5 DOS lőszerkészletet tart (üzemi: 3 DOS + tartalék: 2 DOS).", "tags": ["logisztika", "DOS", "zászlóalj"]},
                {"id": 4, "question": "Hány DOS készletet tart a dandár?", "answers": ["2 DOS", "5 DOS", "7 DOS", "10 DOS"], "correct": 0, "explanation": "A dandár 2 DOS készletet tart a zászlóaljak feltöltésére.", "tags": ["logisztika", "DOS", "dandár"]},
                {"id": 5, "question": "Mi a PUSH logisztika lényege?", "answers": ["Az igénylő szervezet kéri az ellátmányt", "Az ellátó szerv előre megtervezetten tolósíkban szállít", "Helyi beszerzés a hadműveleti területen", "Csak sürgősségi szállítás"], "correct": 1, "explanation": "PUSH logisztika = az ellátó szerv előre megtervezetten, folyamatosan tolósíkban szállítja az ellátmányt a felhasználó felé.", "tags": ["logisztika", "PUSH"]},
                {"id": 6, "question": "Mi a PULL logisztika lényege?", "answers": ["Az ellátó szerv előre megtervezett szerint szállít", "Az igénylő szervezet kezdeményezi az ellátást", "Légi utánpótlás végrehajtása", "Tartalékok elosztása"], "correct": 1, "explanation": "PULL logisztika = az igénylő szervezet kezdeményezése az ellátás iránt (húzósík).", "tags": ["logisztika", "PULL"]},
                {"id": 7, "question": "Melyik nem tartozik a hadtáp szakterületei közé?", "answers": ["Élelmezés", "Ruházat", "Üzemanyag", "Fegyverjavítás"], "correct": 3, "explanation": "A hadtáp szakterületei: élelmezés, ruházat, üzemanyag, közlekedés és szállítás, infrastruktúra. A fegyverjavítás a haditechnikai szolgálathoz tartozik.", "tags": ["logisztika", "hadtáp"]},
                {"id": 8, "question": "Mi a három alapvető élelmiszer-ellátási rendszer?", "answers": ["A-, B-, C-rendszer", "Egytál, kéttál, háromtál", "Normál, csökkentett, emelt", "Tábori, garnizon, menza"], "correct": 0, "explanation": "A három alapvető élelmiszer-ellátási rendszer: A-rendszer (központi), B-rendszer (helyi főzés), C-rendszer (egyéni/harci).", "tags": ["logisztika", "élelmezés"]},
                {"id": 9, "question": "Mi az A-ellátási rendszer lényege?", "answers": ["Helyi alapanyagból főzés", "Központi konyhán készített étel szállítása", "Egyéni harci adagok fogyasztása", "Önellátás helyi beszerzésből"], "correct": 1, "explanation": "A-rendszer: központi konyhán készített étel meleg vagy regenerálható formában történő szállítása.", "tags": ["logisztika", "élelmezés"]},
                {"id": 10, "question": "Mennyi a NATO PHM üzemanyag fajsúlya?", "answers": ["0,70 kg/liter", "0,75 kg/liter", "0,80 kg/liter", "0,85 kg/liter"], "correct": 2, "explanation": "A NATO PHM (Petroleum, oils and lubricants for Helicopters and aircrafts, Missile systems) fajsúlya 0,80 kg/liter.", "tags": ["logisztika", "üzemanyag"]},
                {"id": 11, "question": "Mi a haditechnikai támogatás célja?", "answers": ["Élelmiszer-ellátás biztosítása", "Technikai eszközök hadrafoghatóságának fenntartása", "Személyi állomány képzése", "Híradó összeköttetés biztosítása"], "correct": 1, "explanation": "A haditechnikai támogatás célja a technikai eszközök hadrafoghatóságának fenntartása és helyreállítása.", "tags": ["logisztika", "haditechnika"]},
                {"id": 12, "question": "Mit jelent az LUR rövidítés?", "answers": ["Logisztikai Utánpótlási Rendszer", "Légierő Üzemeltetési Rendelet", "Legközelebbi Utánpótlási Raktár", "Lánctalp Újrahasználati Rendelet"], "correct": 2, "explanation": "LUR = Legközelebbi Utánpótlási Raktár - ahol a szükséges alkatrész készleten van és a legrövidebb idő alatt beszerezhető.", "tags": ["logisztika", "LUR"]},
                {"id": 13, "question": "Mit jelent a menet szempontjából a szervezett pihentetés?", "answers": ["Váratlan megállás", "A menetparancsban meghatározott pihenő", "A vezető saját döntése", "Műszaki hiba miatti leállás"], "correct": 1, "explanation": "Szervezett pihentetés = a menetparancsban meghatározott idejű és helyű pihenő a menet közben.", "tags": ["logisztika", "menet"]},
                {"id": 14, "question": "Mik a tábor alapvető funkcionális területei?", "answers": ["Csak a parancsnokság és a harcállás", "Műveleti, támogató, egészségügyi és egyéb területek", "Csak pihenő és gyakorlótér", "Kizárólag szálláshelyek"], "correct": 1, "explanation": "A tábor alapvető területei: műveleti/harcállás, támogató (logisztikai), egészségügyi és egyéb (sport, pihenő) területek.", "tags": ["logisztika", "tábor"]},
                {"id": 15, "question": "Mi a ROLE 1 egészségügyi ellátás feladata?", "answers": ["Sebészi ellátás", "Elsősegélynyújtás és azonnali életmentés", "Kórházi ellátás", "Rehabilitáció"], "correct": 1, "explanation": "ROLE 1 = elsősegélynyújtás, azonnali életmentő beavatkozás, válogatás, stabilizálás, kiürítésre előkészítés.", "tags": ["egészségügy", "ROLE 1"]},
                {"id": 16, "question": "Hol található a ROLE 1 egészségügyi képesség?", "answers": ["Dandár szinten", "Zászlóalj szinten", "Hadosztály szinten", "Stratégiai szinten"], "correct": 1, "explanation": "ROLE 1 a zászlóalj szintjén található, ez az elsődleges egészségügyi ellátás szintje.", "tags": ["egészségügy", "ROLE 1"]},
                {"id": 17, "question": "Mi a ROLE 2 egészségügyi ellátás fő jellemzője?", "answers": ["Csak elsősegélynyújtás", "Sebészi sürgősségi ellátás és stabilizálás", "Teljes kórházi ellátás", "Csak kiürítés"], "correct": 1, "explanation": "ROLE 2 = resuscitáció, válogatás, sürgősségi sebészeti ellátás, műtét, kórházi tartózkodás, kiürítésre előkészítés.", "tags": ["egészségügy", "ROLE 2"]},
                {"id": 18, "question": "Mit jelent a TCCC rövidítés?", "answers": ["Tactical Combat Casualty Care - harcászati sebesültellátás", "Total Combat Communication Center", "Transport and Cargo Control Command", "Temporary Camp Command Center"], "correct": 0, "explanation": "TCCC = Tactical Combat Casualty Care - harcászati sebesültellátás, harctéri körülmények közötti ellátási protokoll.", "tags": ["egészségügy", "TCCC"]},
                {"id": 19, "question": "Mik a TCCC fázisai?", "answers": ["Előzetes, utólagos, végső", "Tűz alatti ellátás, harcászati terepen ellátás, kiürítés alatti ellátás", "Válogatás, műtét, rehabilitáció", "Diagnosztika, terápia, utógondozás"], "correct": 1, "explanation": "A TCCC három fázisa: 1. Tűz alatti ellátás (CUF), 2. Harcászati terepen ellátás (TFC), 3. Kiürítés alatti ellátás (TACEVAC).", "tags": ["egészségügy", "TCCC"]},
                {"id": 20, "question": "Mi a CUF jelentése a TCCC-ben?", "answers": ["Central Unit Facility", "Care Under Fire - tűz alatti ellátás", "Combat Urgent First-aid", "Casualty Unit Formation"], "correct": 1, "explanation": "CUF = Care Under Fire - a TCCC első fázisa, tűz alatti ellátás, minimális beavatkozás az életmentésért.", "tags": ["egészségügy", "TCCC", "CUF"]},
                {"id": 21, "question": "Mit jelent a '10-1-2+2' szabály a katonai egészségügyben?", "answers": ["10 orvos, 1 ápoló, 2+2 mentős", "10 perc elsősegély, 1 óra ROLE 1, 2 óra ROLE 2, +2 óra ROLE 3", "10 sérült, 1 autó, 2+2 kísérő", "10 km, 1 híd, 2+2 akadály"], "correct": 1, "explanation": "A 10-1-2+2 szabály: 10 perc elsősegély, 1 óra alatt ROLE 1-be, 2 óra alatt ROLE 2-be, további 2 óra alatt ROLE 3-ba juttatás.", "tags": ["egészségügy", "kiürítés"]},
                {"id": 22, "question": "Mi a MEDEVAC jelentése?", "answers": ["Medical Evacuation - egészségügyi kiürítés dedikált eszközzel", "Medicine Evaluation", "Medical Vehicle Command", "Mental Development Activity"], "correct": 0, "explanation": "MEDEVAC = Medical Evacuation - egészségügyi kiürítés dedikált orvosi felszereléssel és személyzettel ellátott eszközzel.", "tags": ["egészségügy", "MEDEVAC"]},
                {"id": 23, "question": "Mi a különbség a MEDEVAC és CASEVAC között?", "answers": ["Nincs különbség", "MEDEVAC: orvosi eszközzel, CASEVAC: bármilyen elérhető eszközzel", "MEDEVAC: légi, CASEVAC: földi", "MEDEVAC: nappal, CASEVAC: éjjel"], "correct": 1, "explanation": "MEDEVAC: dedikált orvosi felszereléssel ellátott eszközzel, CASEVAC: bármilyen elérhető, nem feltétlenül orvosi eszközzel.", "tags": ["egészségügy", "kiürítés"]},
                {"id": 24, "question": "Mit jelent a PRIORITY 1 (URGENT) kiürítési kategória?", "answers": ["Stabil állapot, várhat", "2 órán belüli kiürítés életmentéshez szükséges", "Halott sérült", "Mozgásképes sérült"], "correct": 1, "explanation": "PRIORITY 1 (URGENT) = sürgős, 2 órán belüli kiürítés szükséges az életmentéshez vagy végtagmentéshez.", "tags": ["egészségügy", "kiürítés", "prioritás"]},
                {"id": 25, "question": "Mit jelent a PRIORITY 2 (PRIORITY) kiürítési kategória?", "answers": ["Azonnali kiürítés", "4 órán belüli kiürítés szükséges", "Halálozás várható", "Nincs szükség kiürítésre"], "correct": 1, "explanation": "PRIORITY 2 (PRIORITY) = prioritásos, 4 órán belüli kiürítés szükséges a további állapotromlás megelőzésére.", "tags": ["egészségügy", "kiürítés", "prioritás"]},
                {"id": 26, "question": "Mit jelent a PRIORITY 3 (ROUTINE) kiürítési kategória?", "answers": ["Azonnali kiürítés szükséges", "24 órán belüli kiürítés elegendő", "Halott sérült", "Nem kiüríthető"], "correct": 1, "explanation": "PRIORITY 3 (ROUTINE) = rutinszerű, 24 órán belüli kiürítés elegendő, stabil állapotú sérültek.", "tags": ["egészségügy", "kiürítés", "prioritás"]},
                {"id": 27, "question": "Mi a PECC jelentése?", "answers": ["Patient Evacuation Coordination Cell - betegkiürítés-koordináló cella", "Primary Emergency Care Center", "Personnel Equipment Command Center", "Patrol Element Control Command"], "correct": 0, "explanation": "PECC = Patient Evacuation Coordination Cell - a kiürítés koordinálásáért felelős szervezeti elem.", "tags": ["egészségügy", "PECC"]},
                {"id": 28, "question": "Mi a ROLE 3 egészségügyi ellátás jellemzője?", "answers": ["Elsősegélynyújtás", "Tábori kórház, teljes körű kórházi ellátás", "Csak válogatás", "Rehabilitáció otthon"], "correct": 1, "explanation": "ROLE 3 = tábori kórház, teljes körű kórházi ellátás, minden sebészeti szakág, diagnosztika, intenzív ellátás.", "tags": ["egészségügy", "ROLE 3"]},
                {"id": 29, "question": "Mi a ROLE 4 egészségügyi ellátás?", "answers": ["Harctéri elsősegély", "Zászlóalj egészségügyi pont", "Stratégiai kiürítés és rehabilitáció a honi területen", "Dandár szintű ellátás"], "correct": 2, "explanation": "ROLE 4 = stratégiai szintű ellátás, honi területen lévő kórházak, teljes rehabilitáció.", "tags": ["egészségügy", "ROLE 4"]},
                {"id": 30, "question": "Mi a TFC jelentése a TCCC-ben?", "answers": ["Total Field Care", "Tactical Field Care - harcászati terepen ellátás", "Transport First Command", "Temporary Field Clinic"], "correct": 1, "explanation": "TFC = Tactical Field Care - harcászati terepen ellátás, részletesebb beavatkozás, nincs közvetlen tűzhatás.", "tags": ["egészségügy", "TCCC", "TFC"]},
                {"id": 31, "question": "Melyik nem tartozik a logisztika felosztásához?", "answers": ["Hadtáp", "Haditechnika", "Egészségügy", "Felderítés"], "correct": 3, "explanation": "A logisztika három fő területe: hadtáp, haditechnika és egészségügy. A felderítés a harci támogatáshoz tartozik.", "tags": ["logisztika", "alapfogalom"]},
                {"id": 32, "question": "Mit jelent az üzemi készlet a lőszernél?", "answers": ["Raktári tartalék", "A harctevékenység folytatásához közvetlenül felhasználható készlet", "Javítás alatti lőszer", "Exportra szánt készlet"], "correct": 1, "explanation": "Az üzemi készlet a harctevékenység folytatásához közvetlenül felhasználható készlet (zászlóaljnál 3 DOS).", "tags": ["logisztika", "készlet"]},
                {"id": 33, "question": "Hány napi lőszerkészletet jelent összesen a zászlóalj és dandár együttes készlete?", "answers": ["5 DOS", "7 DOS", "10 DOS", "15 DOS"], "correct": 1, "explanation": "Összesen 7 DOS: zászlóalj 5 DOS + dandár 2 DOS = 7 napi ellátmány.", "tags": ["logisztika", "DOS"]},
                {"id": 34, "question": "Mi a B-ellátási rendszer lényege az élelmezésnél?", "answers": ["Központi konyhán főzés", "Helyi alapanyagból, helyi konyhán főzés", "Egyéni harci adagok", "Import élelmiszer"], "correct": 1, "explanation": "B-rendszer: helyi vagy központilag szállított alapanyagból a helyi konyhán készített étel.", "tags": ["logisztika", "élelmezés"]},
                {"id": 35, "question": "Mi a C-ellátási rendszer lényege?", "answers": ["Központi főzés", "Tábori konyha", "Egyéni/csoportos harci adagok (MRE)", "Vendéglátóipari ellátás"], "correct": 2, "explanation": "C-rendszer: egyéni vagy csoportos harci adagok (pl. MRE), főzés/regenerálás nélkül fogyasztható.", "tags": ["logisztika", "élelmezés"]},
                {"id": 36, "question": "Mit jelent az MRE rövidítés?", "answers": ["Military Radio Equipment", "Meal Ready to Eat - készétel", "Medical Rescue Equipment", "Motorized Response Element"], "correct": 1, "explanation": "MRE = Meal Ready to Eat - azonnal fogyasztható harci élelmiszer-csomag.", "tags": ["logisztika", "élelmezés"]},
                {"id": 37, "question": "Mi a DMC üzemanyag?", "answers": ["Dízel-típusú üzemanyag járművekhez", "Drón Motor Carburant", "Digital Motor Control", "Dual Motor Component"], "correct": 0, "explanation": "DMC (Diesel for Military Consumption) = dízel-típusú üzemanyag szárazföldi járművekhez.", "tags": ["logisztika", "üzemanyag"]},
                {"id": 38, "question": "Melyik nem tartozik a haditechnikai támogatás eszközeihez?", "answers": ["Fegyverek", "Járművek", "Híradó eszközök", "Élelmiszer"], "correct": 3, "explanation": "A haditechnikai támogatás: fegyverek, lőszer, járművek, híradó eszközök, optikai eszközök stb. Az élelmiszer a hadtáphoz tartozik.", "tags": ["logisztika", "haditechnika"]},
                {"id": 39, "question": "Mi a tábori karbantartás célja?", "answers": ["Teljes felújítás", "Üzemképesség gyors helyreállítása a helyszínen", "Alkatrészgyártás", "Leselejtezés"], "correct": 1, "explanation": "A tábori karbantartás célja az üzemképesség gyors helyreállítása a műveleti területen, minimális eszközzel.", "tags": ["logisztika", "karbantartás"]},
                {"id": 40, "question": "Mik a menet végrehajtásának feltételei?", "answers": ["Csak jó időjárás", "Kellő időben kiadott parancs, megfelelő útvonal, pihentetés, biztosítás", "Csak éjszakai végrehajtás", "Minimum 100 jármű"], "correct": 1, "explanation": "Feltételek: kellő időben kiadott menetparancs, megfelelő útvonalak, szervezett pihentetés, biztosítás.", "tags": ["logisztika", "menet"]},
                {"id": 41, "question": "Mi a menetbiztosítás feladata?", "answers": ["Élelmezés biztosítása", "A menetoszlop védelme ellenséges tevékenység és meglepetés ellen", "Rádiókapcsolat fenntartása", "Útvonal karbantartása"], "correct": 1, "explanation": "A menetbiztosítás feladata a menetoszlop védelme ellenséges tevékenység és meglepetés ellen.", "tags": ["logisztika", "menet"]},
                {"id": 42, "question": "Mik a tábor biztonsági követelményei?", "answers": ["Csak kerítés", "Aktív és passzív védelmi rendszabályok, őrzés-védelem, beléptetés", "Csak kamerák", "Nincs szükség védelemre"], "correct": 1, "explanation": "A tábor biztonsága: aktív/passzív védelmi rendszabályok, őrzés-védelem, beléptetés-ellenőrzés, körletbiztonság.", "tags": ["logisztika", "tábor"]},
                {"id": 43, "question": "Mi a válogatás (triage) célja az egészségügyben?", "answers": ["Sérültek azonosítása", "Sérültek sürgősség szerinti csoportosítása az ellátáshoz", "Gyógyszerek elosztása", "Ápolók beosztása"], "correct": 1, "explanation": "A válogatás (triage) célja a sérültek súlyosság és sürgősség szerinti csoportosítása az ellátási sorrend meghatározásához.", "tags": ["egészségügy", "triage"]},
                {"id": 44, "question": "Mi az AXR Zrt. szerepe az MH logisztikában?", "answers": ["Fegyvergyártás", "Haditechnikai javítás és felújítás", "Élelmezés", "Híradó biztosítás"], "correct": 1, "explanation": "Az AXR Zrt. az MH egyik fő haditechnikai javító és felújító vállalata.", "tags": ["logisztika", "haditechnika"]},
                {"id": 45, "question": "Mit jelent az FSB (Forward Support Battalion)?", "answers": ["Előretolt Támogató Zászlóalj", "Tábori Sebészi Bázis", "Főhadiszállás Biztosító Zászlóalj", "Felderítő Szolgálati Bázis"], "correct": 0, "explanation": "FSB = Forward Support Battalion - Előretolt Támogató Zászlóalj, a dandár logisztikai támogatásának végrehajtója.", "tags": ["logisztika", "szervezet"]},
                {"id": 46, "question": "Melyik a helyes kiürítési lánc?", "answers": ["ROLE 4 → ROLE 3 → ROLE 2 → ROLE 1", "ROLE 1 → ROLE 2 → ROLE 3 → ROLE 4", "Véletlenszerű", "Csak ROLE 1 és ROLE 4"], "correct": 1, "explanation": "A kiürítési lánc: ROLE 1 (zászlóalj) → ROLE 2 (dandár) → ROLE 3 (tábori kórház) → ROLE 4 (honi kórházak).", "tags": ["egészségügy", "kiürítés"]},
                {"id": 47, "question": "Mit jelent a tourniquet alkalmazása a TCCC-ben?", "answers": ["Vérzéscsillapító kötés", "Érszorító alkalmazása végtagi vérzésnél", "Légútbiztosítás", "Fájdalomcsillapítás"], "correct": 1, "explanation": "A tourniquet (érszorító) a végtagok súlyos vérzésének csillapítására szolgál, a TCCC alapeszköze.", "tags": ["egészségügy", "TCCC"]},
                {"id": 48, "question": "Mi a fő ellátási feladat a CUF (tűz alatti ellátás) fázisban?", "answers": ["Teljes diagnosztika", "Életmentő vérzéscsillapítás és fedezékbe vonás", "Sebészi beavatkozás", "Rehabilitáció"], "correct": 1, "explanation": "A CUF fázisban: életveszélyes vérzés csillapítása (tourniquet) és a sérült fedezékbe vonása, minimális beavatkozás.", "tags": ["egészségügy", "TCCC", "CUF"]},
                {"id": 49, "question": "Mi a TACEVAC jelentése?", "answers": ["Tactical Evacuation - harcászati kiürítés", "Tank Evacuation", "Technical Evaluation", "Temporary Access Control"], "correct": 0, "explanation": "TACEVAC = Tactical Evacuation - a harcászati kiürítés a TCCC harmadik fázisa.", "tags": ["egészségügy", "TCCC", "kiürítés"]},
                {"id": 50, "question": "Mit jelent az IFAK rövidítés?", "answers": ["Infantry First Aid Kit - egyéni elsősegélykészlet", "Integrated Field Attack Kit", "Internal Force Action Key", "Infantry Field Armor Kit"], "correct": 0, "explanation": "IFAK = Individual First Aid Kit - egyéni elsősegélykészlet, amit minden katona magánál hord.", "tags": ["egészségügy", "IFAK"]},
                {"id": 51, "question": "Mi a készletlépcsőzés célja?", "answers": ["Készletek csökkentése", "Készletek szintenkénti elosztása a gyors reagálás érdekében", "Készletek központosítása", "Készletek megsemmisítése"], "correct": 1, "explanation": "A készletlépcsőzés célja a készletek szintenkénti (zászlóalj, dandár, hadosztály) elosztása a gyors utánpótlás érdekében.", "tags": ["logisztika", "készletlépcsőzés"]},
                {"id": 52, "question": "Mi a menetoszlop-parancsnok feladata?", "answers": ["Csak vezetés", "A menet tervezése, vezetése, sebesség és távolságtartás biztosítása", "Csak élelmezés", "Csak híradó"], "correct": 1, "explanation": "A menetoszlop-parancsnok felelős a menet tervezéséért, vezetéséért, menetsebesség és távolságtartás biztosításáért.", "tags": ["logisztika", "menet"]},
                {"id": 53, "question": "Mi az előőrs feladata menetbiztosításnál?", "answers": ["Élelmezés", "A főerők előtt haladva felderíti és jelenti az akadályokat, ellenséget", "Utóvéd feladatok", "Légvédelem"], "correct": 1, "explanation": "Az előőrs a főerők előtt haladva felderíti az útvonalat, jelenti az akadályokat és ellenséges tevékenységet.", "tags": ["logisztika", "menet"]},
                {"id": 54, "question": "Mi jellemzi a ROLE 2 Light Enhanced (2LE) szintet?", "answers": ["Csak elsősegély", "Damage Control Surgery - életmentő sebészet", "Teljes rehabilitáció", "Csak kiürítés"], "correct": 1, "explanation": "ROLE 2LE = Damage Control Surgery (DCS) - életmentő sebészeti beavatkozás, stabilizálás továbbszállításhoz.", "tags": ["egészségügy", "ROLE 2"]},
                {"id": 55, "question": "Hány napos tartózkodásra terveznek a ROLE 2 szinten?", "answers": ["1-2 nap", "3-5 nap", "1-2 hét", "1 hónap"], "correct": 0, "explanation": "A ROLE 2 szinten 1-2 napos tartózkodásra terveznek, utána továbbszállítás ROLE 3-ba.", "tags": ["egészségügy", "ROLE 2"]},
                {"id": 56, "question": "Mi a STRATEVAC jelentése?", "answers": ["Stratégiai kiürítés honi területre", "Stratégiai támadás", "Strukturált értékelés", "Stressz-kezelési módszer"], "correct": 0, "explanation": "STRATEVAC = Strategic Evacuation - stratégiai kiürítés a honi vagy NATO-tagállami egészségügyi intézményekbe.", "tags": ["egészségügy", "kiürítés"]},
                {"id": 57, "question": "Mit jelent a MARCHE mozaikszó a TCCC-ben?", "answers": ["Massive hemorrhage, Airway, Respiration, Circulation, Hypothermia, Everything else", "Medical Assistance for Rescue of Combat Heroes in Emergency", "Motor Ambulance Rescue for Casualty Handling", "Military Aid Response for Civilian Healthcare"], "correct": 0, "explanation": "MARCHE: Massive hemorrhage (vérzéscsillapítás), Airway (légút), Respiration (légzés), Circulation (keringés), Hypothermia (hővédelem), Everything else (egyéb).", "tags": ["egészségügy", "TCCC", "MARCHE"]},
                {"id": 58, "question": "Mi a Gold/Silver/Bronze rendszer az egészségügyi helyszínelésnél?", "answers": ["Fizetési kategóriák", "Biztonsági zónák: Gold (biztonságos), Silver (átmeneti), Bronze (veszélyes)", "Érdemrendek", "Minőségi szintek"], "correct": 1, "explanation": "Gold: biztonságos zóna, Silver: átmeneti zóna, Bronze: veszélyes zóna - a helyszínelés biztonsági kategóriái.", "tags": ["egészségügy", "helyszínelés"]},
                {"id": 59, "question": "Mit tartalmaz a 9-line MEDEVAC kérés?", "answers": ["9 bekezdéses szabályrendszer", "9 elem: hely, hívójel, sérültek száma, felszerelés, sérültek típusa, biztonság, jelzés, nemzetiség, NBC", "9 orvos neve", "9 gyógyszer"], "correct": 1, "explanation": "A 9-line MEDEVAC szabványos rádiókérés: hely, hívójel, sérültek száma/prioritás, szükséges felszerelés, sérültek mozgathatósága, biztonság, jelzés módja, nemzetiség, NBC szennyezettség.", "tags": ["egészségügy", "MEDEVAC"]},
                {"id": 60, "question": "Mi a Combat Medic (harctéri egészségügyi szakember) képzettsége?", "answers": ["Orvosi diploma", "EMT-P/Paramedic szintű kiterjesztett képzés harcászati körülményekre", "Csak elsősegélynyújtó tanfolyam", "Sebész szakorvos"], "correct": 1, "explanation": "A Combat Medic EMT-P/Paramedic szintű képzettséggel rendelkezik, kiterjesztve harcászati sebesültellátásra.", "tags": ["egészségügy", "személyzet"]},
                {"id": 61, "question": "Mi a menetkészenléti fokozatok jelentősége?", "answers": ["Csak üzemanyag-ellátást szabályozza", "Meghatározza a meginduláshoz szükséges időt és készültségi szintet", "Csak az éjszakai meneteket szabályozza", "Nincs jelentősége"], "correct": 1, "explanation": "A menetkészenléti fokozatok meghatározzák, mennyi idő alatt kell a csapatoknak megindulásra készen állniuk.", "tags": ["logisztika", "menet"]},
                {"id": 62, "question": "Mik a tartalékképzés főbb szempontjai?", "answers": ["Csak pénzügyi tartalék", "Mennyiség, elhelyezés, szállíthatóság, védelem", "Csak orvosi tartalék", "Nincs szükség tartalékra"], "correct": 1, "explanation": "A tartalékképzés szempontjai: elegendő mennyiség, megfelelő elhelyezés, gyors szállíthatóság, védelem biztosítása.", "tags": ["logisztika", "tartalék"]},
                {"id": 63, "question": "Mi a DUSTOFF hívójel jelentése?", "answers": ["Egy helikoptertípus neve", "MEDEVAC helikopter hívójele az amerikai erőknél", "Lőszertípus", "Rádiókód"], "correct": 1, "explanation": "DUSTOFF az amerikai MEDEVAC helikopterek hagyományos hívójele, a vietnámi háborúból származik.", "tags": ["egészségügy", "MEDEVAC"]},
                {"id": 64, "question": "Mit jelent a walking wounded (mozgó sérült)?", "answers": ["Súlyos sérült", "Könnyebben sérült, aki saját lábán képes mozogni", "Halott", "Lelki sérült"], "correct": 1, "explanation": "Walking wounded = enyhébben sérült, aki saját erejéből képes mozogni, általában alacsonyabb kiürítési prioritás.", "tags": ["egészségügy", "triage"]},
                {"id": 65, "question": "Mi az NHP rövidítés a tábori mozgásnál?", "answers": ["Nemzeti Határvédelmi Program", "Napi Haladási Parancs", "Napközbeni Haladási (Pihenő) terv", "Navigációs Híradó Pont"], "correct": 2, "explanation": "Az NHP a menethez kapcsolódó napi haladási és pihenő terv.", "tags": ["logisztika", "menet"]},
                {"id": 66, "question": "Melyik nem tartozik az élelmezési normához?", "answers": ["A-norma (garnizon)", "B-norma (tábori)", "C-norma (harci adag)", "D-norma (díszebéd)"], "correct": 3, "explanation": "Az élelmezési normák: A (garnizon), B (tábori), C (harci adag). D-norma nem létezik.", "tags": ["logisztika", "élelmezés"]},
                {"id": 67, "question": "Hol van az MH Role 2 képesség telepítve békeidőben?", "answers": ["Budapest", "Hódmezővásárhely", "Székesfehérvár", "Debrecen"], "correct": 1, "explanation": "Az MH Role 2 egészségügyi képesség békeidőben Hódmezővásárhelyen állomásozik.", "tags": ["egészségügy", "ROLE 2", "MH"]},
                {"id": 68, "question": "Mi a fő különbség a logisztikai és a harci támogatás között?", "answers": ["Nincs különbség", "Logisztika: ellátás és fenntartás, harci támogatás: közvetlen harcvezetés", "Logisztika: tűztámogatás, harci támogatás: ellátás", "Mindkettő ugyanaz"], "correct": 1, "explanation": "Logisztika: ellátás, fenntartás, egészségügy. Harci támogatás: felderítés, tűzérség, légierő, műszaki, EHV, híradó.", "tags": ["logisztika", "alapfogalom"]},
                {"id": 69, "question": "Mit jelent a Combat Lifesaver (CLS) program?", "answers": ["Harci életmentő - alapszintű egészségügyi képzés nem-egészségügyi katonáknak", "Életbiztosítási program", "Harctéri lélekgyógyászat", "Légierő mentőprogram"], "correct": 0, "explanation": "Combat Lifesaver = harci életmentő képzés nem-egészségügyi katonáknak, alapszintű sebesültellátási ismeretek.", "tags": ["egészségügy", "CLS"]},
                {"id": 70, "question": "Melyik nem igaz a katonai ellátási láncra?", "answers": ["Célja a harcoló csapatok támogatása", "A civil ellátási lánccal azonos működési elvek", "Magában foglalja a hadtápot, haditechnikát és egészségügyet", "Hierarchikus felépítésű"], "correct": 1, "explanation": "A katonai ellátási lánc eltér a civiltől: hadszíntéri körülmények, biztonsági szempontok, rugalmasság más elvek alapján.", "tags": ["logisztika", "ellátási lánc"]}
            ]
        };

        // Quiz SM-2 Algorithm (adapted for quiz format)
        class QuizSM2 {
            static defaultQuestion() {
                return {
                    easeFactor: 2.5,
                    interval: 0,
                    repetitions: 0,
                    nextReview: Date.now(),
                    lastReview: null,
                    correctCount: 0,
                    incorrectCount: 0
                };
            }

            static calculate(question, isCorrect) {
                let { easeFactor, interval, repetitions, correctCount, incorrectCount } = question;

                if (isCorrect) {
                    correctCount++;
                    // Quality 4 for correct answer
                    if (repetitions === 0) {
                        interval = 1;
                    } else if (repetitions === 1) {
                        interval = 6;
                    } else {
                        interval = Math.round(interval * easeFactor);
                    }
                    repetitions++;
                    easeFactor = Math.max(1.3, easeFactor + 0.1);
                } else {
                    incorrectCount++;
                    // Reset on incorrect
                    repetitions = 0;
                    interval = 0; // Ask again soon
                    easeFactor = Math.max(1.3, easeFactor - 0.2);
                }

                const nextReview = Date.now() + interval * 24 * 60 * 60 * 1000;

                return {
                    easeFactor,
                    interval,
                    repetitions,
                    nextReview,
                    lastReview: Date.now(),
                    correctCount,
                    incorrectCount
                };
            }
        }

        // Main Quiz App
        class QuizApp {
            constructor() {
                this.questions = [];
                this.currentIndex = 0;
                this.answered = false;
                this.selectedAnswer = null;
                this.sessionStats = { correct: 0, incorrect: 0, streak: 0, maxStreak: 0 };
                this.studyQueue = [];
                this.storageKey = 'quiz_progress';

                this.init();
            }

            async init() {
                await this.loadQuestions();
                this.loadProgress();
                this.buildStudyQueue();
                this.render();
                this.bindEvents();
            }

            async loadQuestions() {
                let data = null;

                try {
                    const response = await fetch('quiz.json');
                    if (response.ok) {
                        data = await response.json();
                        console.log('Loaded from quiz.json');
                    }
                } catch (error) {
                    console.log('External JSON not available, using embedded data');
                }

                if (!data) {
                    data = DEFAULT_DATA;
                }

                this.quizInfo = data.quiz;
                this.questions = data.questions.map(q => ({
                    ...q,
                    ...QuizSM2.defaultQuestion(),
                    ...(this.getQuestionProgress(q.id) || {})
                }));

                document.getElementById('deckInfo').textContent =
                    `${this.quizInfo.name} - ${this.questions.length} kérdés`;
            }

            loadProgress() {
                try {
                    const saved = localStorage.getItem(this.storageKey);
                    this.progress = saved ? JSON.parse(saved) : {};
                } catch {
                    this.progress = {};
                }
            }

            saveProgress() {
                this.questions.forEach(q => {
                    this.progress[q.id] = {
                        easeFactor: q.easeFactor,
                        interval: q.interval,
                        repetitions: q.repetitions,
                        nextReview: q.nextReview,
                        lastReview: q.lastReview,
                        correctCount: q.correctCount,
                        incorrectCount: q.incorrectCount
                    };
                });
                localStorage.setItem(this.storageKey, JSON.stringify(this.progress));
            }

            getQuestionProgress(questionId) {
                return this.progress ? this.progress[questionId] : null;
            }

            buildStudyQueue() {
                const now = Date.now();
                const dueQuestions = this.questions.filter(q => q.nextReview <= now);

                // Sort: prioritize incorrect/new, then by due date
                dueQuestions.sort((a, b) => {
                    // New questions first
                    if (a.repetitions === 0 && b.repetitions > 0) return -1;
                    if (a.repetitions > 0 && b.repetitions === 0) return 1;
                    // Then by accuracy (lower accuracy = higher priority)
                    const aAccuracy = a.correctCount / Math.max(1, a.correctCount + a.incorrectCount);
                    const bAccuracy = b.correctCount / Math.max(1, b.correctCount + b.incorrectCount);
                    if (aAccuracy !== bAccuracy) return aAccuracy - bAccuracy;
                    // Then by due date
                    return a.nextReview - b.nextReview;
                });

                this.studyQueue = dueQuestions;
                this.currentIndex = 0;
            }

            getStats() {
                return {
                    total: this.questions.length,
                    due: this.studyQueue.length,
                    mastered: this.questions.filter(q => q.interval >= 21).length,
                    accuracy: this.sessionStats.correct + this.sessionStats.incorrect > 0
                        ? Math.round(this.sessionStats.correct / (this.sessionStats.correct + this.sessionStats.incorrect) * 100)
                        : 0
                };
            }

            getCurrentQuestion() {
                return this.studyQueue[this.currentIndex];
            }

            shuffleAnswers(question) {
                // Create answer objects with original indices
                // Answers can be strings or objects with text and image
                const answers = question.answers.map((answer, index) => {
                    const isObject = typeof answer === 'object';
                    return {
                        text: isObject ? answer.text : answer,
                        image: isObject ? answer.image : null,
                        isCorrect: index === question.correct
                    };
                });

                // Fisher-Yates shuffle
                for (let i = answers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [answers[i], answers[j]] = [answers[j], answers[i]];
                }

                return answers;
            }

            selectAnswer(index) {
                if (this.answered) return;

                this.answered = true;
                this.selectedAnswer = index;

                const question = this.getCurrentQuestion();
                const isCorrect = this.shuffledAnswers[index].isCorrect;

                // Update stats
                if (isCorrect) {
                    this.sessionStats.correct++;
                    this.sessionStats.streak++;
                    this.sessionStats.maxStreak = Math.max(this.sessionStats.maxStreak, this.sessionStats.streak);
                } else {
                    this.sessionStats.incorrect++;
                    this.sessionStats.streak = 0;
                }

                // Update question with SM-2
                const updated = QuizSM2.calculate(question, isCorrect);
                Object.assign(question, updated);

                // If incorrect, add back to queue for later
                if (!isCorrect) {
                    this.studyQueue.push(question);
                }

                this.saveProgress();
                this.render();
            }

            nextQuestion() {
                if (!this.answered) return;

                this.currentIndex++;
                this.answered = false;
                this.selectedAnswer = null;
                this.shuffledAnswers = null;
                this.render();
            }

            resetProgress() {
                if (confirm('Biztosan törölni szeretnéd az összes haladási adatot?')) {
                    localStorage.removeItem(this.storageKey);
                    this.progress = {};
                    this.questions.forEach(q => {
                        Object.assign(q, QuizSM2.defaultQuestion());
                    });
                    this.sessionStats = { correct: 0, incorrect: 0, streak: 0, maxStreak: 0 };
                    this.buildStudyQueue();
                    this.render();
                }
            }

            render() {
                const app = document.getElementById('app');
                const stats = this.getStats();
                const question = this.getCurrentQuestion();
                const progress = this.currentIndex / Math.max(1, this.studyQueue.length) * 100;

                if (!question) {
                    // Session complete
                    const scorePercent = stats.accuracy;
                    app.innerHTML = `
                        <div class="stats-bar">
                            <div class="stat-item correct">
                                <div class="stat-value">${this.sessionStats.correct}</div>
                                <div class="stat-label">Helyes</div>
                            </div>
                            <div class="stat-item incorrect">
                                <div class="stat-value">${this.sessionStats.incorrect}</div>
                                <div class="stat-label">Hibás</div>
                            </div>
                            <div class="stat-item streak">
                                <div class="stat-value">${this.sessionStats.maxStreak}</div>
                                <div class="stat-label">Max sorozat</div>
                            </div>
                            <div class="stat-item mastered">
                                <div class="stat-value">${stats.mastered}</div>
                                <div class="stat-label">Elsajátított</div>
                            </div>
                        </div>

                        <div class="session-complete">
                            <h2>Gratulálok!</h2>
                            <p>Minden esedékes kérdést megválaszoltál.</p>

                            <div class="score-circle" style="--score: ${scorePercent * 3.6}deg">
                                <span class="score-value">${scorePercent}%</span>
                            </div>

                            <div class="session-stats">
                                <div class="session-stat">
                                    <div class="session-stat-value" style="color: #00ff88">${this.sessionStats.correct}</div>
                                    <div class="session-stat-label">Helyes válasz</div>
                                </div>
                                <div class="session-stat">
                                    <div class="session-stat-value" style="color: #ff6b6b">${this.sessionStats.incorrect}</div>
                                    <div class="session-stat-label">Hibás válasz</div>
                                </div>
                            </div>

                            <div class="controls">
                                <button class="control-btn" onclick="app.buildStudyQueue(); app.render();">
                                    Frissítés
                                </button>
                                <button class="control-btn" onclick="app.resetProgress()">
                                    Visszaállítás
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Shuffle answers if not already done
                if (!this.shuffledAnswers) {
                    this.shuffledAnswers = this.shuffleAnswers(question);
                }

                const keys = ['A', 'B', 'C', 'D'];
                let answersHtml = this.shuffledAnswers.map((answer, i) => {
                    let classes = 'answer-btn';
                    if (this.answered) {
                        if (answer.isCorrect) {
                            classes += i === this.selectedAnswer ? ' correct' : ' show-correct';
                        } else if (i === this.selectedAnswer) {
                            classes += ' incorrect';
                        }
                    }
                    return `
                        <button class="${classes}" onclick="app.selectAnswer(${i})" ${this.answered ? 'disabled' : ''}>
                            <span class="answer-key">${keys[i]}</span>
                            ${answer.text}
                            ${answer.image ? `<img src="${answer.image}" class="answer-image" alt="">` : ''}
                        </button>
                    `;
                }).join('');

                const isCorrect = this.answered && this.shuffledAnswers[this.selectedAnswer]?.isCorrect;

                app.innerHTML = `
                    <div class="stats-bar">
                        <div class="stat-item correct">
                            <div class="stat-value">${this.sessionStats.correct}</div>
                            <div class="stat-label">Helyes</div>
                        </div>
                        <div class="stat-item incorrect">
                            <div class="stat-value">${this.sessionStats.incorrect}</div>
                            <div class="stat-label">Hibás</div>
                        </div>
                        <div class="stat-item streak">
                            <div class="stat-value">${this.sessionStats.streak} 🔥</div>
                            <div class="stat-label">Sorozat</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${stats.due - this.currentIndex}</div>
                            <div class="stat-label">Hátralévő</div>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>

                    <div class="question-card">
                        <div class="question-number">Kérdés ${this.currentIndex + 1} / ${this.studyQueue.length}</div>
                        <div class="question-text">${question.question}</div>
                        ${question.image ? `<img src="${question.image}" class="question-image" alt="">` : ''}
                        <div class="question-tags">
                            ${(question.tags || []).map(t => `<span class="tag">${t}</span>`).join('')}
                        </div>
                    </div>

                    <div class="answers-container">
                        ${answersHtml}
                    </div>

                    <div class="feedback ${this.answered ? 'visible' : ''} ${isCorrect ? 'correct' : 'incorrect'}">
                        <div class="feedback-icon">${isCorrect ? '✓' : '✗'}</div>
                        <div class="feedback-text">${isCorrect ? 'Helyes válasz!' : 'Sajnos nem jó.'}</div>
                        <div class="feedback-explanation">${question.explanation || ''}</div>
                    </div>

                    <button class="next-btn ${this.answered ? 'visible' : ''}" onclick="app.nextQuestion()">
                        Következő kérdés →
                    </button>
                `;
            }

            bindEvents() {
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT') return;

                    switch(e.key) {
                        case '1':
                            if (!this.answered) this.selectAnswer(0);
                            break;
                        case '2':
                            if (!this.answered) this.selectAnswer(1);
                            break;
                        case '3':
                            if (!this.answered) this.selectAnswer(2);
                            break;
                        case '4':
                            if (!this.answered) this.selectAnswer(3);
                            break;
                        case 'Enter':
                            if (this.answered) this.nextQuestion();
                            break;
                        case 'r':
                        case 'R':
                            this.resetProgress();
                            break;
                    }
                });

                // File input handler
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            this.quizInfo = data.quiz || { name: file.name, description: '' };
                            this.questions = data.questions.map(q => ({
                                ...q,
                                ...QuizSM2.defaultQuestion()
                            }));

                            document.getElementById('deckInfo').textContent =
                                `${this.quizInfo.name} - ${this.questions.length} kérdés`;

                            this.sessionStats = { correct: 0, incorrect: 0, streak: 0, maxStreak: 0 };
                            this.buildStudyQueue();
                            this.render();
                        } catch (error) {
                            alert('Hibás JSON formátum! Ellenőrizd a fájlt.');
                        }
                    };
                    reader.readAsText(file);
                    e.target.value = '';
                });
            }
        }

        // Initialize
        const app = new QuizApp();
    </script>
</body>
</html>
